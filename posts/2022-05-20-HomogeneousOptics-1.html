<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Theodore A. Corcovilos">
<meta name="dcterms.date" content="2022-05-20">

<title>Corcovilos Lab - Optics in Homogeneous Coordinates, Introduction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-114117860-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Corcovilos Lab</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../research.html" rel="" target="">
 <span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../publications.html" rel="" target="">
 <span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../teaching.html" rel="" target="">
 <span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog.html" rel="" target="">
 <span class="menu-text">Blog Posts</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto tools-wide">
    <a href="https://twitter.com/TedCorcovilos" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/corcoted" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
    <a href="https://www.linkedin.com/in/ted-corcovilos" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-linkedin"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#motivation" id="toc-motivation" class="nav-link active" data-scroll-target="#motivation">Motivation</a>
  <ul class="collapse">
  <li><a href="#case-1-imaging-problems" id="toc-case-1-imaging-problems" class="nav-link" data-scroll-target="#case-1-imaging-problems">Case 1: Imaging problems</a></li>
  <li><a href="#case-2-ray-tracing" id="toc-case-2-ray-tracing" class="nav-link" data-scroll-target="#case-2-ray-tracing">Case 2: Ray tracing</a></li>
  <li><a href="#the-goal" id="toc-the-goal" class="nav-link" data-scroll-target="#the-goal">The goal</a></li>
  </ul></li>
  <li><a href="#a-homogenous-vector-representation-of-lines" id="toc-a-homogenous-vector-representation-of-lines" class="nav-link" data-scroll-target="#a-homogenous-vector-representation-of-lines">A homogenous vector representation of lines</a>
  <ul class="collapse">
  <li><a href="#the-equation-of-a-line" id="toc-the-equation-of-a-line" class="nav-link" data-scroll-target="#the-equation-of-a-line">The equation of a line</a></li>
  <li><a href="#normalization" id="toc-normalization" class="nav-link" data-scroll-target="#normalization">Normalization</a></li>
  <li><a href="#orientation" id="toc-orientation" class="nav-link" data-scroll-target="#orientation">Orientation</a></li>
  </ul></li>
  <li><a href="#the-ray-transfer-matrices" id="toc-the-ray-transfer-matrices" class="nav-link" data-scroll-target="#the-ray-transfer-matrices">The ray-transfer matrices</a></li>
  <li><a href="#wrapping-up" id="toc-wrapping-up" class="nav-link" data-scroll-target="#wrapping-up">Wrapping up</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Optics in Homogeneous Coordinates, Introduction</h1>
  <div class="quarto-categories">
    <div class="quarto-category">research</div>
    <div class="quarto-category">optics</div>
    <div class="quarto-category">papers</div>
  </div>
  </div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Theodore A. Corcovilos </p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="www.duq.edu">
            Duquesne University
            </a>
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 20, 2022</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">August 4, 2023</p>
    </div>
  </div>
    
  </div>
  
<div>
  <div class="abstract">
    <div class="abstract-title">Abstract</div>
    I introduce the homogeneous representation of rays and extend the ABCD matrices to include rotations and translations (properly!).
  </div>
</div>

</header>

<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>This is the first post discussing my new paper on a new way to look at geometric optics. I deconstruct the familiar ABCD ray-transfer matrices and rebuild them based on geometric considerations. The paper itself is published in <em>American Journal of Physics</em><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. These blog posts will focus on the motivation and how to use the results.</p>
</div>
</div>
</div>
<p><a href="../posts/2022-07-01-HomogeneousOptics-2.html">Part 2 is here.</a></p>
<section id="motivation" class="level2">
<h2 class="anchored" data-anchor-id="motivation">Motivation</h2>
<section id="case-1-imaging-problems" class="level3">
<h3 class="anchored" data-anchor-id="case-1-imaging-problems">Case 1: Imaging problems</h3>
<p>When teaching undergraduate optics, I always found the problems containing series of lenses and mirrors tedious. The standard solution is to find the image of an object created by each optical element using Gauss’s Lens equation. This image then becomes the object for the next element. Apply Gauss’s equation again. Rinse and repeat. For one or two lenses this is not too bad, but once you get to something like a microscope (objective, tube lens, and ocular), then it really drags. Worse, if your object moves a little bit you have to start over. And there is also the weird issue of infinitely far objects and images to deal with. It seems a little incomplete. I’m looking for a better, or at least less tedious, method.</p>
<p>One solution is that I can take two rays that pass through my object point and find where they intersect on the output side to locate the image, but that’s still a lot of algebra, and I am lazy.</p>
</section>
<section id="case-2-ray-tracing" class="level3">
<h3 class="anchored" data-anchor-id="case-2-ray-tracing">Case 2: Ray tracing</h3>
<p>In my research lab, we mostly deal with lasers, which to a reasonable approximation can be treated as geometric rays (at least as far as alignment is concerned). When sketching out a new optical setup, I’ll often use <a href="https://en.wikipedia.org/wiki/Ray_transfer_matrix_analysis">ray transfer matrices</a> (also called “ABCD” matrices) to set things up. Each ray is represented as a vector containing the ray height and slope. Each optical element corresponds to a matrix. By multiplying these matrices together we can get a representation of the entire optical system. Matrix times input ray equals output ray.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
But wait! There’s more!
</div>
</div>
<div class="callout-body-container callout-body">
<p>The same ABCD matrix that describes the path of geometric rays through the system also describes the change in size of Gaussian laser beams as they travel through the system. This seems like magic, because there is no apparent relationship between rays and the size of diffracting laser beams. The detailed proof requires digging into the guts of the diffraction integrals<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. Surely there is a simpler explanation. (Arnaud has a nice model using complex-valued rays<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>, which again seems like magic, but at least understandable magic.)</p>
</div>
</div>
<p>This is great, as far as it goes, but it assumes all of the lenses and mirrors are perfectly aligned and centered. Often that just isn’t the case. For example, a common right-of-passage for students in a laser lab is learning to inject a beam into a fiber. There’s a lot of degrees of freedom that you have to manage to high precision:</p>
<ul>
<li>x, y, and z position of the focusing lens</li>
<li>two tilt angles of the lens</li>
<li>two tilt angles of the incomming beam</li>
<li>the location of the beam’s waist</li>
</ul>
<p>Can we put together a concise mathematical model of all of these degrees of freedom?</p>
</section>
<section id="the-goal" class="level3">
<h3 class="anchored" data-anchor-id="the-goal">The goal</h3>
<p>What I would really like to do is find a solution that lets me model optical elements in any position or orientation and lets me solve imaging problems. And I would like it to be as simple to use as the ABCD matrices. Can I get there starting from the old-fashioned ABCD matrices?</p>
<p>The answer is “yes,” but first I need to re-examine what the ABCD matrices are doing to the rays, in a geometric sense. And to do <em>that</em>, I first need to mathematically define rays as oriented lines.</p>
</section>
</section>
<section id="a-homogenous-vector-representation-of-lines" class="level2">
<h2 class="anchored" data-anchor-id="a-homogenous-vector-representation-of-lines">A homogenous vector representation of lines</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/figs/2022-optics/line.svg" class="img-fluid figure-img" data-alt-text="a line in 2D"></p>
<figcaption class="figure-caption">The equation of an oriented line. In this example, <em>a</em> and <em>b</em> &gt; 0 and <em>c</em>&lt;0.</figcaption>
</figure>
</div>
<section id="the-equation-of-a-line" class="level3">
<h3 class="anchored" data-anchor-id="the-equation-of-a-line">The equation of a line</h3>
<p>Let’s start with the equation for a line in two-dimensions. If our coordinate axes are (<em>x</em>,<em>y</em>) then any line will have the form <span class="math inline">\(ax+by+c=0\)</span> . Rather than write down the equation for every line, we could just keep track of the coefficients (<em>a</em>,<em>b</em>,<em>c</em>). Also, if we multiply the whole equation (or all of the coefficients) by a non-zero scalar, we get the same line. In other words, the vector (<em>a</em>,<em>b</em>,<em>c</em>) gives us a <em>homogenous</em> representation of the line.</p>
<p>I think most of us almost habitually use the slope-intersept form of a line: <span class="math inline">\(y = mx+h\)</span> . In our new represenation we rearrange this to <span class="math inline">\(mx -y + h = 0\)</span> and identify the coeffients as (<em>m</em>,-1,<em>h</em>). (Hold on to this – it will be important.)</p>
</section>
<section id="normalization" class="level3">
<h3 class="anchored" data-anchor-id="normalization">Normalization</h3>
<p>Because we can multiply the line coefficients by any nonzero scalar, is there any prefered normalization? For most of what we’ll be doing, the normalization won’t matter, but let’s take a quick peek. One convenient choice is to divide the line coefficients by <span class="math inline">\(\sqrt{a^2+b^2}\)</span> . Then the new <em>a</em> and <em>b</em> coefficients become the cosines of the angles between the axes and the line and the new <em>c</em> value gives the (signed) distance from the origin to the line. With this normalization, the angle <em>θ</em> between any two lines can be calculated easily: <span class="math inline">\(\theta=\arccos(a_1a_2+b_1b_2)\)</span> (proven by applying some trig identities).</p>
</section>
<section id="orientation" class="level3">
<h3 class="anchored" data-anchor-id="orientation">Orientation</h3>
<p>Besides normalization, we have one more degree of freedom that we can assign meaning to: the overall sign of the coefficients. We’ll interpret this as <em>orientation</em> or the direction of travel along the line. For <em>b</em>&gt;0 the line goes left-to-right. If <em>b</em>=0, then <em>a</em>&gt;0 indicates downward. Lastly, if <em>a</em>=<em>b</em>=0, then <em>c</em>&gt;0 is the imaginary line infinitely far away encircling the space in a counter-clockwise direction.</p>
<p>By keeping track of these signs, we can build an expression for mirrors that also changes the direction of the rays.</p>
</section>
</section>
<section id="the-ray-transfer-matrices" class="level2">
<h2 class="anchored" data-anchor-id="the-ray-transfer-matrices">The ray-transfer matrices</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/figs/2022-optics/ABCD.svg" class="img-fluid figure-img" data-alt-text="Ray transfer matrix schematic"></p>
<figcaption class="figure-caption">The ABCD matrices. The incoming ray <em>r</em> is transformed into the outgoing ray <em>r’</em>. Note that the outgoing coordinate system is different than the incoming coordinate system. We’ll address this in the next blog post.</figcaption>
</figure>
</div>
<p>Let’s back up to the beginning and look at one way to describe optical systems. If we have an incoming ray <em>r</em> that passes through the input plane of the optical system with height <em>h</em> and slope <em>m</em> and an outgoing ray <em>r’</em> with height and slope <em>h’</em> and <em>m’</em>, we can relate these by the matrix equation</p>
<p><span class="math display">\[
\begin{pmatrix} h' \\\ m' \end{pmatrix}
=
\begin{pmatrix} A &amp; B \\\ C &amp; D \end{pmatrix}
\begin{pmatrix} h \\\ m \end{pmatrix}.
\]</span></p>
<p>Now, let’s do the same transformation on a line as we described above. Our point-slope version of a line has homogeneous coordinates (<em>a</em>,<em>b</em>,<em>c</em>) = (<em>m</em>,-1,<em>h</em>). By rearranging the order of the coefficients, we can get</p>
<p><span class="math display">\[
\begin{pmatrix} h' \\\ m' \\\ -1 \end{pmatrix}
=
\begin{pmatrix} A &amp; B &amp; 0
\\\ C &amp; D &amp; 0
\\\ 0 &amp; 0 &amp; 1 \end{pmatrix}
\begin{pmatrix} h \\\ m \\\ -1 \end{pmatrix}.
\]</span> or more generally, <span class="math display">\[
\begin{pmatrix} c' \\\ a' \\\ b' \end{pmatrix}
=
\begin{pmatrix} A &amp; B &amp; 0
\\\ C &amp; D &amp; 0
\\\ 0 &amp; 0 &amp; 1 \end{pmatrix}
\begin{pmatrix} c \\\ a \\\ b \end{pmatrix}.
\]</span></p>
<p>This is similar enough to our original ABCD matrices that it has some promise without being too far from where we started.</p>
</section>
<section id="wrapping-up" class="level2">
<h2 class="anchored" data-anchor-id="wrapping-up">Wrapping up</h2>
<p>What have we done here? I’ll admit it looks underwhelming. We’ve added an extra dimension to our ray-transfer matrix, but it doesn’t seem to <em>do</em> anything but multiply a bunch of ones together.</p>
<p>There are two important things here. First, the original ABCD matrices look more like a bookkeeping tool than anything “real”, because we’re just keeping track of some coefficients. (In fact, standard optical engineering textbooks usually dismiss them as pointless fluff<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> or don’t mention them at all<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>.) But now, we see a bit of geometry. We have a general description of a line being transformed into another line.</p>
<p>Second, we have added some additional degrees of freedom to our framework. We used one of these to add a meaningful orientation to the lines. Three more degrees of freedom can be used to translate and rotate the coordinate axes or, equivalently, our optical elements. This will be the topic of Part 2.</p>
<p><em><a href="../posts/2022-07-01-HomogeneousOptics-2.html">Continued in Part 2</a></em></p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>T. Corcovilos. Beyond the ABCDs: A projective geometry treatment of paraxial ray tracing using homogeneous coordinates. <em>American Journal of Physics</em> 91(6):449-457 (2023). doi:<a href="http://doi.org/10.1119/5.0083069">10.1119/5.0083069</a> Preprint at arXiv:<a href="http://arxiv.org/abs/2205.09746">2205.09746</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>S. A. Collins, J. Opt. Soc. Am., JOSA 60, 1168 (1970). <a href="https://doi.org/10.1364/JOSA.60.001168">doi:10.1364/JOSA.60.001168</a><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>J. Arnaud, Applied Optics 24, 538 (1985). <a href="https://doi.org/10.1364/AO.24.000538">doi:10.1364/AO.24.000538</a><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>W. J. Smith, Modern Optical Engineering: The Design of Optical Systems, 4th ed (McGraw Hill, New York, 2008). ISBN: 978-0-07-147687-4<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>M. J. Kidger, Fundamental Optical Design (SPIE, Bellingham, 2000). ISBN: 978-0-8194-9599-0<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">Copyright 2023, Ted Corcovilos</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>