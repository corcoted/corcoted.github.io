<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Theodore A. Corcovilos">
<meta name="dcterms.date" content="2018-02-15">

<title>Corcovilos Lab - Simple eye test without fancy equipment</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/social-share-0.1.0/social-share.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/social-share-0.1.0/all.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-114117860-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="Corcovilos Lab - Simple eye test without fancy equipment">
<meta property="og:description" content="Most of us are familiar with the refraction exam done by optometrists to determine our eyeglass prescription. Here’s a different method without the fancy equipment. The only tool we need is a tape measure and an object to look at, like a chart or point-source of light like an LED.">
<meta property="og:site-name" content="Ted Corcovilos's Lab webpage">
<meta name="twitter:title" content="Ted Corcovilos’s Lab webpage">
<meta name="twitter:description" content="Most of us are familiar with the refraction exam done by optometrists to determine our eyeglass prescription. Here’s a different method without the fancy equipment. The only tool we need is a tape measure and an object to look at, like a chart or point-source of light like an LED.">
<meta name="twitter:creator" content="@TedCorcovilos">
<meta name="twitter:site" content="@TedCorcovilos">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Corcovilos Lab</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../research.html" rel="" target="">
 <span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../publications.html" rel="" target="">
 <span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../teaching.html" rel="" target="">
 <span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog.html" rel="" target="">
 <span class="menu-text">Blog Posts</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto tools-wide">
    <a href="https://twitter.com/TedCorcovilos" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/corcoted" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
    <a href="https://www.linkedin.com/in/ted-corcovilos" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-linkedin"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#normal-vision" id="toc-normal-vision" class="nav-link active" data-scroll-target="#normal-vision">Normal vision</a></li>
  <li><a href="#optical-power-and-diopters" id="toc-optical-power-and-diopters" class="nav-link" data-scroll-target="#optical-power-and-diopters">Optical power and diopters</a></li>
  <li><a href="#eyeglasses" id="toc-eyeglasses" class="nav-link" data-scroll-target="#eyeglasses">Eyeglasses</a></li>
  <li><a href="#the-test" id="toc-the-test" class="nav-link" data-scroll-target="#the-test">The test</a></li>
  <li><a href="#astigmatism" id="toc-astigmatism" class="nav-link" data-scroll-target="#astigmatism">Astigmatism</a></li>
  <li><a href="#what-weve-left-out" id="toc-what-weve-left-out" class="nav-link" data-scroll-target="#what-weve-left-out">What we’ve left out</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Simple eye test without fancy equipment</h1>
  <div class="quarto-categories">
    <div class="quarto-category">teaching</div>
    <div class="quarto-category">optics</div>
  </div>
  </div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Theodore A. Corcovilos </p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="www.duq.edu">
            Duquesne University
            </a>
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 15, 2018</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="abstract-title">Abstract</div>
    Most of us are familiar with the refraction exam done by optometrists to determine our eyeglass prescription. Here’s a different method without the fancy equipment. The only tool we need is a tape measure and an object to look at, like a chart or point-source of light like an LED.
  </div>
</div>

</header>

<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>This idea came from a homework problem I gave my Optics class: start with an eyeglass prescription and determine the near and far limits of clear vision. The following is the reverse of that problem.</p>
</div>
</div>
</div>
<p>Most of us are familiar with the <a href="http://en.wikipedia.org/wiki/Subjective_refraction">refraction exam</a> done by optometrists to determine our eyeglass prescription. The test involves the patient trying to read a chart placed at reading distance (20 in ≈ 50 cm) or at a standard far distance (20 ft ≈ 6 m) while the optometrist tries placing different lenses in front of each eye to find the lenses that give the best image for the patient. The test is largely trial-and-error. A good practicioner can reach an optimal lens with only a few trials. Here’s a method to measure myopia (nearsightedness), hyperopia (farsightedness), and presbyopia (age-related farsightedness) without the <a href="http://en.wikipedia.org/wiki/Phoropter">fancy equipment</a>. The only tool we need is a tape measure and an object to look at, like a chart or point-source of light like an LED.</p>
<p>(Unfortunately this test doesn’t work for astigmatism, the other common vision defect, without a special charge. Some suggestions for this <a href="#astigmatism">below</a>.)</p>
<section id="normal-vision" class="level3">
<h3 class="anchored" data-anchor-id="normal-vision">Normal vision</h3>
<p>“Normal vision” means that a person can clearly see an object at both reading distance (50 cm) and at far distance (ideally infinity, but 20 ft ≈ 6 m is considered good enough).<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> We can model the eye as a single lens with variable focal length <em>f</em> and a fixed image distance <em>s’</em>. A reasonable approximation is that <em>s’</em> = 16.7 mm.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> Using Gauss’s Lens equation we can solve for the values of focal length in the near and far cases:</p>
<p><span class="math display">\[
\begin{align*}
\frac{1}{f} &amp;= \frac{1}{s} + \frac{1}{s'} \\
f_{far} &amp;= \left(\frac{1}{\infty} + \frac{1}{16.7\,\mathrm{mm}} \right)^{-1} = 16.7\,\mathrm{mm} \\
f_{near} &amp;= \left(\frac{1}{500\,\mathrm{mm}} + \frac{1}{16.7\,\mathrm{mm}} \right)^{-1} = 16.2\,\mathrm{mm}
\end{align*}
\]</span></p>
<div class="callout callout-style-simple callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Who turned the lights out?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Did you ever wonder why eye exams are done in a darkened room? This is to dilate the pupils and <em>maximize</em> the effects of aberations in the eye’s optical system. This makes the test more sensitive. Another effect of dilation is that spherical aberation makes the effective focal length of the eye shorter than it would be in bright light – this is what causes night-time myopia.</p>
</div>
</div>
<p>The ability of the human eye to change its focal length is called <em>accomodation</em>. As we age we lose this ability and the eye gets stuck more towards the <em>f<sub>far</sub></em> value. This is why older people need reading glasses. It’s also why the medicine used to dilate pupils for an eye exam makes it difficult to read: the muscles responsible for accomodation are paralyzed so the lens is stuck in “far” mode until the medicine wears off.</p>
<p>So, just to recap: a normal, healthy eye can vary its focal length between <em>f<sub>far</sub></em> = 16.7 mm and <em>f<sub>near</sub></em> = 16.2 mm.</p>
</section>
<section id="optical-power-and-diopters" class="level3">
<h3 class="anchored" data-anchor-id="optical-power-and-diopters">Optical power and diopters</h3>
<p>Optometrists don’t speak in terms of focal length but in terms of optical power. Optical power is defined as the reciprocal of focal length:</p>
<p><span class="math display">\[
P = \frac{1}{f}
\]</span></p>
<p>and is usually specified with units of “diopters” = m<sup>-1</sup>. So, we can express the focal length range of the eye in terms of optical power instead:</p>
<p><span class="math display">\[
\begin{align*}
P_{near} &amp;= \frac{1}{f_{near}} = \frac{1}{16.2\,\mathrm{mm}} = 61.9\,\mathrm{m^{-1}} = 61.9\,\text{diopters} \\
P_{far} &amp;= \frac{1}{f_{far}} = \frac{1}{16.7\,\mathrm{mm}} = 59.9\,\mathrm{m^{-1}} = 59.9\,\text{diopters}
\end{align*}
\]</span></p>
</section>
<section id="eyeglasses" class="level3">
<h3 class="anchored" data-anchor-id="eyeglasses">Eyeglasses</h3>
<p>Diopters are also the units used for eyeglass and contact-lens prescriptions. If your eyeglasses are <em>P</em> = -5.00 diopters, then they have a focal length of <em>f</em> = 1/<em>P</em> = -0.2 m.</p>
<p>So, what do eyeglasses do? In the approximation that the lenses are close to the eye, the optical power of the eyeglasses adds to the optical power of the eye’s lens to bring the combination to the nominal values above.</p>
</section>
<section id="the-test" class="level3">
<h3 class="anchored" data-anchor-id="the-test">The test</h3>
<p>The test is simple. Take a tape measure (at least 6-m long for best results) and stretch it out as far as possible (on the floor of a hallway works best). With your eye placed at the end of the tape measure (and the other eye closed), move a test object as close as possible such that you can still clearly see it. Record this distance as <em>d’<sub>near</sub></em>. Next, move the object as far away as possible along the tape measure until it is just no longer clear. Record this distance as <em>d’<sub>far</sub></em>. (If you can place the object past the end of the tape, let <em>d’<sub>far</sub></em> = the length of the tape) If <em>d’<sub>far</sub></em> ≥ 6 m and <em>d’<sub>near</sub></em> ≤ 25 cm, then you have “normal” vision. If your measurements aren’t in those limits, then we can do a little algebra to estimate an eyeglass prescription.</p>
<p>Here’s how the calculation goes:</p>
<ol type="1">
<li><p>The first step is to calculate the range of optical powers implied by the measured distances. For example, the near distance <em>d’<sub>near</sub></em> gives the maximum optical power of the eye. (I’ll use primes to indicate the values for the person.) From the lens equation:</p>
<p><span class="math display">\[
P'_{near} = \frac{1}{f'_{near}} = \frac{1}{d'_{near}} + \frac{1}{s_i}.
\]</span></p>
<p>Similarly, for <em>P’<sub>far</sub></em> which is the minimum optical power of the eye.</p></li>
<li><p>We need to compare the measured optical powers to the “normal” values given above.</p>
<ul>
<li>If <em>P’<sub>near</sub></em> &gt; <em>P<sub>near</sub></em> then the person is <em>far-sighted</em> and the optical power of the eyeglasses needed to correct the vision is <em>P<sub>glasses</sub></em> = <em>P<sub>near</sub></em> - <em>P’<sub>near</sub></em>, which will be a positive number.</li>
<li>If <em>P’<sub>far</sub></em> &lt; <em>P<sub>far</sub></em> then the person is <em>near-sighted</em> and the optical power of the eyeglasses needed to correct the vision is <em>P<sub>glasses</sub></em> = <em>P<sub>far</sub></em> - <em>P’<sub>far</sub></em>, which will be a negative number.</li>
</ul></li>
<li><p>Wait! What if we choose glasses to correct near-sightedness, but it makes it hard to read because the new near power is too small(<em>P’<sub>near</sub></em> + <em>P<sub>glasses</sub></em> &lt; <em>P<sub>near</sub></em>). Or maybe we correct far-sightedness to improve reading, but now distance vision is compromised. In these cases we need bifocal lenses: the top part of the lens will be used for distance vision and the bottom lens for reading. The recipe then is</p>
<ul>
<li>If <em>P’<sub>near</sub></em> + <em>P<sub>glasses</sub></em> &lt; <em>P<sub>near</sub></em>, then we need to add a power <em>P<sub>add</sub></em> = <em>P<sub>near</sub></em>-(<em>P’<sub>near</sub></em> + <em>P<sub>glasses</sub></em>) to the original perscription for the bifocal lens.</li>
<li>If <em>P’<sub>far</sub></em> + <em>P<sub>glasses</sub></em> &gt; <em>P<sub>far</sub></em>, then we need to subtract some power from the main lens and add it back for the bifocal lens. The amount of this correction is <em>P<sub>add</sub></em> = (<em>P’<sub>far</sub></em> + <em>P<sub>glasses</sub></em>)-<em>P<sub>far</sub></em>.</li>
</ul></li>
</ol>
<p>That’s it! Will a tape measure and a couple of lines of algebra we’ve estimated an eyeglass prescription. Of course this doesn’t replace a professional exam, but it could be useful in places without access to medical equipment.</p>
</section>
<section id="astigmatism" class="level3">
<h3 class="anchored" data-anchor-id="astigmatism">Astigmatism</h3>
<p>The test described here doesn’t work for measuring astigmatism. Astigmatism is when the focusing of the eye depends on the orientation of the <em>object</em>. For example, vertical lines may focus at a different distance than horizontal lines. It’s caused by the eye not having cylindrical symmetry about the optical axis. (For example, the eye is squished from side-to-side.) To correct for astigmatism, a cylindrical correction is added to the eyeglass lenses, and the resulting final lens is often shaped like a slice of a torus (donut).</p>
<p>The test above could be modified by using a target that looks like a spoked wheel as the object and asking the test subject to identify, for example, the closest distance at which only one spoke is clear and the closest distance at which all the spokes can be clear (but not at the same time – the eye’s autofocus ability will switch between spokes). This way the cylinder axis and additional cylinder power can be approximated.</p>
</section>
<section id="what-weve-left-out" class="level3">
<h3 class="anchored" data-anchor-id="what-weve-left-out">What we’ve left out</h3>
<p>The model here has been simplified as much as possible. The night-myopia described above has been left out, and we haven’t tried to calculate the actual visual acuity (how small of an object can be resolved). Most importantly, this test doesn’t assess any diseases of the eye, such as glaucoma or cataracts. Even if your vision is perfect, regular eye exams by a professional are necessary to protect your eyes.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>F. L. Pedrotti, L. M. Pedrotti, L. S. Pedrotti, <em>Introduction to Optics</em> (Pearson, Harlow, ed.&nbsp;3rd, 2007).<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>In an actual human eye the interior is filled with <em>vitreous humor</em>, a gel substance with an index of refraction of about <em>n</em> = 1.33. For simplicity, I’ve adjusted the actual image distance (approximately the diameter of the eye = 22 mm) to account for the index of refraction. The focal lengths I use above are the object-side focal lengths of the combined cornea-lens system.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="corcoted/corcoted.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkxMTg5ODAyOTM=" data-category="General" data-category-id="DIC_kwDOBxd-xc4CYXKb" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">Copyright 2023, Ted Corcovilos</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>
<div class="page-columns page-rows-contents page-layout-article"><div class="social-share"><a href="https://twitter.com/share?url=https://www.corcoviloslab.com/&amp;text=Ted Corcovilos’s Lab website" target="_blank" class="twitter"><i class="fab fa-twitter fa-fw fa-lg"></i></a><a href="https://www.linkedin.com/shareArticle?url=https://www.corcoviloslab.com/&amp;title=Ted Corcovilos’s Lab website" target="_blank" class="linkedin"><i class="fa-brands fa-linkedin-in fa-fw fa-lg"></i></a>  <a href="mailto:?subject=Ted Corcovilos’s Lab website&amp;body=Check out this link:https://www.corcoviloslab.com/" target="_blank" class="email"><i class="fa-solid fa-envelope fa-fw fa-lg"></i></a><a href="https://www.facebook.com/sharer.php?u=https://www.corcoviloslab.com/" target="_blank" class="facebook"><i class="fab fa-facebook-f fa-fw fa-lg"></i></a><a href="https://reddit.com/submit?url=https://www.corcoviloslab.com/&amp;title=Ted Corcovilos’s Lab website" target="_blank" class="reddit">   <i class="fa-brands fa-reddit-alien fa-fw fa-lg"></i></a></div></div>



</body></html>